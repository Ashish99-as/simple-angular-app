pipeline {
    agent any

    environment {
        IMAGE_NAME = "ashishpra123/simple-angular-app"
        DOCKER_TOKEN = credentials('dockerhub-token')
    }

    stages {

        stage('Checkout Code') {
            steps {
                git branch: 'main',
                    url: 'https://github.com/ashishpra123/simple-angular-app.git'
            }
        }

        stage('Build Docker Image') {
            steps {
                sh """
                docker build -t ${IMAGE_NAME}:latest .
                """
            }
        }

        stage('Docker Login') {
            steps {
                sh """
                echo ${DOCKER_TOKEN} | docker login -u ashishpra123 --password-stdin
                """
            }
        }

        stage('Push Image to Docker Hub') {
            steps {
                sh """
                docker push ${IMAGE_NAME}:latest
                """
            }
        }

        stage('Deploy Container') {
            steps {
                sh """
                docker stop simpleangularapp || true
                docker rm simpleangularapp || true
                docker run -d --name simpleangularapp -p 80:80 ${IMAGE_NAME}:latest
                """
            }
        }
    }
}

